{"description": "Detects suspicious print spool service (spoolsv.exe) child processes.", "author": ["Justin C. (@endisphotic)", "@dreadphones (detection)", "Thomas Patzke (Sigma rule)"], "enabled": false, "false_positives": ["Unknown"], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "dcdbc940-0bff-46b2-95f3-2d73f848e33b", "language": "lucene", "max_signals": 100, "risk_score": 65, "name": "Suspicious Spool Service Child Process", "query": "((process.parent.executable.text:\"*\\\\spoolsv.exe\" AND IntegrityLevel:\"System\") AND ((((((((((process.executable.text:(\"*\\\\gpupdate.exe\" OR \"*\\\\whoami.exe\" OR \"*\\\\nltest.exe\" OR \"*\\\\taskkill.exe\" OR \"*\\\\wmic.exe\" OR \"*\\\\taskmgr.exe\" OR \"*\\\\sc.exe\" OR \"*\\\\findstr.exe\" OR \"*\\\\curl.exe\" OR \"*\\\\wget.exe\" OR \"*\\\\certutil.exe\" OR \"*\\\\bitsadmin.exe\" OR \"*\\\\accesschk.exe\" OR \"*\\\\wevtutil.exe\" OR \"*\\\\bcdedit.exe\" OR \"*\\\\fsutil.exe\" OR \"*\\\\cipher.exe\" OR \"*\\\\schtasks.exe\" OR \"*\\\\write.exe\" OR \"*\\\\wuauclt.exe\" OR \"*\\\\systeminfo.exe\" OR \"*\\\\reg.exe\" OR \"*\\\\query.exe\")) OR ((process.executable.text:(\"*\\\\net.exe\" OR \"*\\\\net1.exe\") AND (NOT process.command_line.text:\"*start*\"))))) OR ((process.executable.text:\"*\\\\cmd.exe\" AND (NOT process.command_line.text:(\"*.spl*\" OR \"*route\\ add*\" OR \"*program\\ files*\")))))) OR ((process.executable.text:\"*\\\\netsh.exe\" AND (NOT process.command_line.text:(\"*add\\ portopening*\" OR \"*rule\\ name*\")))))) OR ((process.executable.text:(\"*\\\\powershell.exe\" OR \"*\\\\pwsh.exe\") AND (NOT process.command_line.text:\"*.spl*\"))))) OR ((((process.executable.text:\"*\\\\rundll32.exe\") OR (winlog.event_data.OriginalFileName:\"RUNDLL32.EXE\")) AND process.command_line.text:\"*rundll32.exe\"))))", "meta": {"from": "1m"}, "severity": "high", "tags": ["Privilege Escalation", "T1068", "T1203"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0002", "reference": "https://attack.mitre.org/tactics/TA0002", "name": "Execution"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1203", "name": "Exploitation for Client Execution", "reference": "https://attack.mitre.org/techniques/T1203"}]}, {"tactic": {"id": "TA0004", "reference": "https://attack.mitre.org/tactics/TA0004", "name": "Privilege Escalation"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1068", "name": "Exploitation for Privilege Escalation", "reference": "https://attack.mitre.org/techniques/T1068"}]}], "version": 1, "references": ["https://github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/efa17a600b43c897b4b7463cc8541daa1987eeb4/Exploits/Print%20Spooler%20RCE/Suspicious%20Spoolsv%20Child%20Process.md"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
