{"description": "Detects execution of the \"mofcomp\" utility as a child of a suspicious shell or script running utility or by having a supsicious path in the commandline.\nThe \"mofcomp\" utility parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository.\nAttackers abuse this utility to install malicious MOF scripts\n", "author": ["Nasreddine Bencherchali (Nextron Systems)"], "enabled": false, "false_positives": ["Unknown"], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "1dd05363-104e-4b4a-b963-196a534b03a1", "language": "lucene", "max_signals": 100, "risk_score": 65, "name": "Potential Suspicious Mofcomp Execution", "query": "(((((process.executable.text:\"*\\\\mofcomp.exe\") OR (winlog.event_data.OriginalFileName:\"mofcomp.exe\")) AND ((process.parent.executable.text:(\"*\\\\cmd.exe\" OR \"*\\\\powershell.exe\" OR \"*\\\\pwsh.exe\" OR \"*\\\\wsl.exe\" OR \"*\\\\wscript.exe\" OR \"*\\\\cscript.exe\")) OR (process.command_line.text:(\"*\\\\AppData\\\\Local\\\\Temp*\" OR \"*\\\\Users\\\\Public\\\\*\" OR \"*\\\\WINDOWS\\\\Temp\\\\*\" OR \"*%temp%*\" OR \"*%tmp%*\" OR \"*%appdata%*\")))) AND (NOT (process.parent.executable.text:\"C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\" AND process.command_line.text:\"*C\\:\\\\Windows\\\\TEMP\\\\*\" AND process.command_line.text:\"*.mof\"))) AND (NOT (process.command_line.text:\"*C\\:\\\\Windows\\\\TEMP\\\\*\" AND process.command_line.text:\"*.mof\")))", "meta": {"from": "1m"}, "severity": "high", "tags": ["T1218"], "to": "now", "type": "query", "threat": [], "version": 1, "references": ["https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/", "https://github.com/The-DFIR-Report/Sigma-Rules/blob/75260568a7ffe61b2458ca05f6f25914efb44337/win_mofcomp_execution.yml", "https://docs.microsoft.com/en-us/windows/win32/wmisdk/mofcomp"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
