{"description":"Detects modification of autostart extensibility point (ASEP) in registry. Author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split). License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md","enabled":false,"false_positives":["Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason","Legitimate administrator sets up autorun keys for legitimate reason"],"filters":[],"from":"now-360s","immutable":false,"index":["winlogbeat-*"],"interval":"5m","rule_id":"d326c13c-5ae7-9aaa-63a4-1714130e285b","language":"lucene","output_index":".siem-signals-default","max_signals":100,"risk_score":35,"name":"CurrentVersion Autorun Keys Modification","query":"((winlog.event_data.EventType:\"SetValue\" AND winlog.event_data.TargetObject:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion* AND winlog.event_data.TargetObject:(*\\\\ShellServiceObjectDelayLoad* OR *\\\\Run\\\\* OR *\\\\RunOnce\\\\* OR *\\\\Policies\\\\System\\\\Shell* OR *\\\\Policies\\\\Explorer\\\\Run* OR *\\\\Group\\ Policy\\\\Scripts\\\\Startup* OR *\\\\Group\\ Policy\\\\Scripts\\\\Shutdown* OR *\\\\Group\\ Policy\\\\Scripts\\\\Logon* OR *\\\\Group\\ Policy\\\\Scripts\\\\Logoff* OR *\\\\Explorer\\\\ShellServiceObjects* OR *\\\\Explorer\\\\ShellIconOverlayIdentifiers* OR *\\\\Explorer\\\\ShellExecuteHooks* OR *\\\\Explorer\\\\SharedTaskScheduler* OR *\\\\Explorer\\\\Browser\\ Helper\\ Objects* OR *\\\\Authentication\\\\PLAP\\ Providers* OR *\\\\Authentication\\\\Credential\\ Providers* OR *\\\\Authentication\\\\Credential\\ Provider\\ Filters*)) AND (NOT ((winlog.event_data.Details:\"\\(Empty\\)\" OR winlog.event_data.TargetObject:*\\\\NgcFirst\\\\ConsecutiveSwitchCount OR process.executable:(*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe OR *\\\\AppData\\\\Roaming\\\\Spotify\\\\Spotify.exe) OR process.executable:(\"C\\:\\\\WINDOWS\\\\system32\\\\devicecensus.exe\" OR \"C\\:\\\\Program\\ Files\\\\Microsoft\\ OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe\" OR \"C\\:\\\\Program\\ Files\\\\KeePass\\ Password\\ Safe\\ 2\\\\ShInstUtil.exe\" OR \"C\\:\\\\Program\\ Files\\\\Everything\\\\Everything.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\ Office\\\\root\\\\integration\\\\integrator.exe\")) OR (process.executable:(C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeWebView\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe*)) OR (process.executable:\"C\\:\\\\Windows\\\\system32\\\\regsvr32.exe\" AND winlog.event_data.TargetObject:*DropboxExt* AND winlog.event_data.Details:*A251\\-47B7\\-93E1\\-CDD82E34AF8B\\}) OR (winlog.event_data.TargetObject:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera\\ Browser\\ Assistant AND winlog.event_data.Details:\"C\\:\\\\Program\\ Files\\\\Opera\\\\assistant\\\\browser_assistant.exe\") OR (winlog.event_data.TargetObject:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\iTunesHelper AND winlog.event_data.Details:\"\\\"C\\:\\\\Program\\ Files\\\\iTunes\\\\iTunesHelper.exe\\\"\") OR (winlog.event_data.TargetObject:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\zoommsirepair AND winlog.event_data.Details:\"\\\"C\\:\\\\Program\\ Files\\\\Zoom\\\\bin\\\\installer.exe\\\"\\ \\/repair\") OR (winlog.event_data.TargetObject:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Greenshot AND winlog.event_data.Details:\"C\\:\\\\Program\\ Files\\\\Greenshot\\\\Greenshot.exe\") OR (winlog.event_data.TargetObject:*\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\GoogleDriveFS AND winlog.event_data.Details:C\\:\\\\Program\\ Files\\\\Google\\\\Drive\\ File\\ Stream\\\\* AND winlog.event_data.Details:*\\\\GoogleDriveFS.exe\\ \\-\\-startup_mode) OR (winlog.event_data.TargetObject:*GoogleDrive* AND winlog.event_data.Details:(\"\\{CFE8B367\\-77A7\\-41D7\\-9C90\\-75D16D7DC6B6\\}\" OR \"\\{A8E52322\\-8734\\-481D\\-A7E2\\-27B309EF8D56\\}\" OR \"\\{C973DA94\\-CBDF\\-4E77\\-81D1\\-E5B794FBD146\\}\" OR \"\\{51EF1569\\-67EE\\-4AD6\\-9646\\-E726C3FFC8A2\\}\")) OR (winlog.event_data.Details:C\\:\\\\Windows\\\\system32\\\\cmd.exe\\ \\/q\\ \\/c\\ rmdir\\ \\/s\\ \\/q\\ \\\"C\\:\\\\Users\\\\* AND winlog.event_data.Details:*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\*) OR (winlog.event_data.TargetObject:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\\\{c60fd5ac\\-367d\\-4e3a\\-a975\\-f157502ac30a\\} AND winlog.event_data.Details:*\\\\AppData\\\\Local\\\\Package\\ Cache\\\\\\{c60fd5ac\\-367d\\-4e3a\\-a975\\-f157502ac30a\\}\\\\python* AND winlog.event_data.Details:*.exe\\\"\\ \\/burn.runonce) OR (process.executable:(C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\* OR C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\Updates\\\\*) AND process.executable:*\\\\OfficeClickToRun.exe) OR (process.executable:\"C\\:\\\\Program\\ Files\\\\Windows\\ Defender\\\\MsMpEng.exe\"))))","meta":{"from":"1m"},"severity":"medium","tags":["T1547"],"to":"now","type":"query","threat":[{"tactic":{"id":"TA0003","reference":"https://attack.mitre.org/tactics/TA0003","name":"Persistence"},"framework":"MITRE ATT&CKÂ®","technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547"}]}],"version":1,"references":["https://tdm.socprime.com/tdm/info/0"]}
