{"description": "Detects changes to registry keys related to \"Trusted Location\" of Microsoft Office where the path is set to something uncommon. Attackers might add additional trusted locations to avoid macro security restrictions.", "author": ["Nasreddine Bencherchali (Nextron Systems)"], "enabled": false, "false_positives": ["Other unknown legitimate or custom paths need to be filtered to avoid false positives"], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "f742bde7-9528-42e5-bd82-84f51a8387d2", "language": "lucene", "max_signals": 100, "risk_score": 65, "name": "Uncommon Microsoft Office Trusted Location Added", "query": "(((winlog.event_data.EventType:Setvalue AND winlog.event_data.TargetObject:/.*[Ss][Ee][Cc][Uu][Rr][Ii][Tt][Yy]\\\\\\\\[Tt][Rr][Uu][Ss][Tt][Ee][Dd]\\ [Ll][Oo][Cc][Aa][Tt][Ii][Oo][Nn][Ss]\\\\\\\\[Ll][Oo][Cc][Aa][Tt][Ii][Oo][Nn].*/ AND winlog.event_data.TargetObject:/.*\\\\\\\\[Pp][Aa][Tt][Hh]/) AND (NOT (((process.executable:/[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\\\\\[Cc][Oo][Mm][Mm][Oo][Nn]\\ [Ff][Ii][Ll][Ee][Ss]\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Ss][Hh][Aa][Rr][Ee][Dd]\\\\\\\\[Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\\\\\\\.*/ AND process.executable:/.*\\\\\\\\[Oo][Ff][Ff][Ii][Cc][Ee][Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\.[Ee][Xx][Ee]/)) OR ((process.executable:(/[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\\\\\.*/ OR /[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\\\\\.*/) AND process.executable:(/.*\\\\\\\\[Ww][Ii][Nn][Ww][Oo][Rr][Dd]\\.[Ee][Xx][Ee]/ OR /.*\\\\\\\\[Ee][Xx][Cc][Ee][Ll]\\.[Ee][Xx][Ee]/)))))) AND (NOT winlog.event_data.Details:(/%[Aa][Pp][Pp][Dd][Aa][Tt][Aa]%\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss].*/ OR /%%[Aa][Pp][Pp][Dd][Aa][Tt][Aa]%%\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss].*/ OR /%[Aa][Pp][Pp][Dd][Aa][Tt][Aa]%\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\\\\\[Ww][Oo][Rr][Dd]\\\\\\\\[Ss][Tt][Aa][Rr][Tt][Uu][Pp].*/ OR /%%[Aa][Pp][Pp][Dd][Aa][Tt][Aa]%%\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\\\\\[Ww][Oo][Rr][Dd]\\\\\\\\[Ss][Tt][Aa][Rr][Tt][Uu][Pp].*/ OR /[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\\\\\[Rr][Oo][Oo][Tt]\\\\\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss]\\\\\\\\.*/ OR /[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\ \\([Xx]86\\)\\\\\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss].*/ OR /[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\\\\\[Rr][Oo][Oo][Tt]\\\\\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss]\\\\\\\\.*/ OR /[Cc]\\:\\\\\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\\\\\[Tt][Ee][Mm][Pp][Ll][Aa][Tt][Ee][Ss]\\\\\\\\.*/)))", "meta": {"from": "1m"}, "severity": "high", "tags": ["Defense Evasion", "T1112"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0005", "reference": "https://attack.mitre.org/tactics/TA0005", "name": "Defense Evasion"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1112", "name": "Modify Registry", "reference": "https://attack.mitre.org/techniques/T1112"}]}], "version": 1, "references": ["Internal Research", "https://admx.help/?Category=Office2016&Policy=excel16.Office.Microsoft.Policies.Windows::L_TrustedLoc01"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
