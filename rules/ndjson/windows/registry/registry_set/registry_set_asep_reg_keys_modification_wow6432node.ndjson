{"description": "Detects modification of autostart extensibility point (ASEP) in registry.", "author": ["Victor Sergeev", "Daniil Yugoslavskiy", "Gleb Sukhodolskiy", "Timur Zinniatullin", "oscd.community", "Tim Shelton", "frack113 (split)"], "enabled": false, "false_positives": ["Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason", "Legitimate administrator sets up autorun keys for legitimate reason"], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "b29aed60-ebd1-442b-9cb5-16a1d0324adb", "language": "lucene", "max_signals": 100, "risk_score": 35, "name": "Wow6432Node CurrentVersion Autorun Keys Modification", "query": "((winlog.event_data.TargetObject:/.*\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Ww][Oo][Ww]6432[Nn][Oo][Dd][Ee]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Cc][Uu][Rr][Rr][Ee][Nn][Tt][Vv][Ee][Rr][Ss][Ii][Oo][Nn].*/ AND winlog.event_data.TargetObject:(/.*\\\\[Ss][Hh][Ee][Ll][Ll][Ss][Ee][Rr][Vv][Ii][Cc][Ee][Oo][Bb][Jj][Ee][Cc][Tt][Dd][Ee][Ll][Aa][Yy][Ll][Oo][Aa][Dd].*/ OR /.*\\\\[Rr][Uu][Nn]\\\\.*/ OR /.*\\\\[Rr][Uu][Nn][Oo][Nn][Cc][Ee]\\\\.*/ OR /.*\\\\[Rr][Uu][Nn][Oo][Nn][Cc][Ee][Ee][Xx]\\\\.*/ OR /.*\\\\[Rr][Uu][Nn][Ss][Ee][Rr][Vv][Ii][Cc][Ee][Ss]\\\\.*/ OR /.*\\\\[Rr][Uu][Nn][Ss][Ee][Rr][Vv][Ii][Cc][Ee][Ss][Oo][Nn][Cc][Ee]\\\\.*/ OR /.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Ss][Hh][Ee][Ll][Ll][Ss][Ee][Rr][Vv][Ii][Cc][Ee][Oo][Bb][Jj][Ee][Cc][Tt][Ss].*/ OR /.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Ss][Hh][Ee][Ll][Ll][Ii][Cc][Oo][Nn][Oo][Vv][Ee][Rr][Ll][Aa][Yy][Ii][Dd][Ee][Nn][Tt][Ii][Ff][Ii][Ee][Rr][Ss].*/ OR /.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Ss][Hh][Ee][Ll][Ll][Ee][Xx][Ee][Cc][Uu][Tt][Ee][Hh][Oo][Oo][Kk][Ss].*/ OR /.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Ss][Hh][Aa][Rr][Ee][Dd][Tt][Aa][Ss][Kk][Ss][Cc][Hh][Ee][Dd][Uu][Ll][Ee][Rr].*/ OR /.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Bb][Rr][Oo][Ww][Ss][Ee][Rr]\\ [Hh][Ee][Ll][Pp][Ee][Rr]\\ [Oo][Bb][Jj][Ee][Cc][Tt][Ss].*/)) AND (NOT ((winlog.event_data.Details:/\\([Ee][Mm][Pp][Tt][Yy]\\)/) OR (process.executable:/.*[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Ee][Dd][Gg][Ee][Uu][Pp][Dd][Aa][Tt][Ee]\\\\[Ii][Nn][Ss][Tt][Aa][Ll][Ll]\\\\\\{.*/ AND process.executable:/.*\\\\[Ss][Ee][Tt][Uu][Pp]\\.[Ee][Xx][Ee].*/) OR ((process.executable:/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Cc][Oo][Mm][Mm][Oo][Nn]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Ss][Hh][Aa][Rr][Ee][Dd]\\\\[Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\\\[Oo][Ff][Ff][Ii][Cc][Ee][Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\.[Ee][Xx][Ee]/ AND winlog.event_data.TargetObject:/.*\\\\[Oo][Ff][Ff][Ii][Cc][Ee]\\\\[Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\\\[Rr][Ee][Gg][Ii][Ss][Tt][Rr][Yy]\\\\[Mm][Aa][Cc][Hh][Ii][Nn][Ee]\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Ww][Oo][Ww]6432[Nn][Oo][Dd][Ee]\\\\.*/)) OR ((process.executable:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\[Rr][Oo][Oo][Tt]\\\\[Ii][Nn][Tt][Ee][Gg][Rr][Aa][Tt][Ii][Oo][Nn]\\\\[Ii][Nn][Tt][Ee][Gg][Rr][Aa][Tt][Oo][Rr]\\.[Ee][Xx][Ee]/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\ \\([Xx]86\\)\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Oo][Ff][Ff][Ii][Cc][Ee]\\\\[Rr][Oo][Oo][Tt]\\\\[Ii][Nn][Tt][Ee][Gg][Rr][Aa][Tt][Ii][Oo][Nn]\\\\[Ii][Nn][Tt][Ee][Gg][Rr][Aa][Tt][Oo][Rr]\\.[Ee][Xx][Ee]/) AND winlog.event_data.TargetObject:/.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Bb][Rr][Oo][Ww][Ss][Ee][Rr]\\ [Hh][Ee][Ll][Pp][Ee][Rr]\\ [Oo][Bb][Jj][Ee][Cc][Tt][Ss]\\\\\\{31[Dd]09[Bb][Aa]0\\-12[Ff]5\\-4[Cc][Cc][Ee]\\-[Bb][Ee]8[Aa]\\-2923[Ee]76605[Dd][Aa]\\}\\\\.*/)) OR (((winlog.event_data.Details:/.*\\-[Aa]251\\-47[Bb]7\\-93[Ee]1\\-[Cc][Dd][Dd]82[Ee]34[Aa][Ff]8[Bb]\\}/) OR (winlog.event_data.Details:/[Gg][Rr][Pp][Cc][Oo][Nn][Vv]\\ \\-[Oo]/) OR (winlog.event_data.Details:/.*[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss].*/ AND winlog.event_data.Details:/.*\\\\[Dd][Rr][Oo][Pp][Bb][Oo][Xx]\\\\[Cc][Ll][Ii][Ee][Nn][Tt]\\\\[Dd][Rr][Oo][Pp][Bb][Oo][Xx]\\.[Ee][Xx][Ee].*/ AND winlog.event_data.Details:/.*\\ \\/[Ss][Yy][Ss][Tt][Ee][Mm][Ss][Tt][Aa][Rr][Tt][Uu][Pp].*/))) OR (winlog.event_data.TargetObject:/.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Bb][Rr][Oo][Ww][Ss][Ee][Rr]\\ [Hh][Ee][Ll][Pp][Ee][Rr]\\ [Oo][Bb][Jj][Ee][Cc][Tt][Ss]\\\\\\{92[Ee][Ff]2[Ee][Aa][Dd]\\-[Aa]7[Cc][Ee]\\-4424\\-[Bb]0[Dd][Bb]\\-499[Cc][Ff]856608[Ee]\\}\\\\[Nn][Oo][Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]/) OR ((process.executable:/.*\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss][Dd][Ee][Ss][Kk][Tt][Oo][Pp]\\-[Rr][Uu][Nn][Tt][Ii][Mm][Ee]\\-.*/ AND winlog.event_data.TargetObject:(/.*\\\\[Ww][Oo][Ww]6432[Nn][Oo][Dd][Ee]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Cc][Uu][Rr][Rr][Ee][Nn][Tt][Vv][Ee][Rr][Ss][Ii][Oo][Nn]\\\\[Rr][Uu][Nn][Oo][Nn][Cc][Ee]\\\\\\{[Ee]2[Dd]1[Aa][Ee]32\\-[Dd][Dd]1[Dd]\\-4[Aa][Dd]7\\-[Aa]298\\-10[Ee]42[Ee]7840[Ff][Cc]\\}/ OR /.*\\\\[Ww][Oo][Ww]6432[Nn][Oo][Dd][Ee]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Cc][Uu][Rr][Rr][Ee][Nn][Tt][Vv][Ee][Rr][Ss][Ii][Oo][Nn]\\\\[Rr][Uu][Nn][Oo][Nn][Cc][Ee]\\\\\\{7037[Bb]699\\-7382\\-448[Cc]\\-89[Aa]7\\-4765961[Dd]2537\\}/) AND winlog.event_data.Details:/\\\"[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm][Dd][Aa][Tt][Aa]\\\\[Pp][Aa][Cc][Kk][Aa][Gg][Ee]\\ [Cc][Aa][Cc][Hh][Ee]\\\\.*/ AND winlog.event_data.Details:/.*\\.[Ee][Xx][Ee]\\\"\\ \\/[Bb][Uu][Rr][Nn]\\.[Rr][Uu][Nn][Oo][Nn][Cc][Ee]/)) OR ((process.executable:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Cc][Oo][Mm][Mm][Oo][Nn]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Ss][Hh][Aa][Rr][Ee][Dd]\\\\[Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\\\.*/ OR /[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Cc][Oo][Mm][Mm][Oo][Nn]\\ [Ff][Ii][Ll][Ee][Ss]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\ [Ss][Hh][Aa][Rr][Ee][Dd]\\\\[Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\\\[Uu][Pp][Dd][Aa][Tt][Ee][Ss]\\\\.*/) AND process.executable:/.*\\\\[Oo][Ff][Ff][Ii][Cc][Ee][Cc][Ll][Ii][Cc][Kk][Tt][Oo][Rr][Uu][Nn]\\.[Ee][Xx][Ee]/)) OR (winlog.event_data.Details:/\\\"[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm][Dd][Aa][Tt][Aa]\\\\[Pp][Aa][Cc][Kk][Aa][Gg][Ee]\\ [Cc][Aa][Cc][Hh][Ee]\\\\\\{[Dd]21[Aa]4[Ff]20\\-968[Aa]\\-4[Bb]0[Cc]\\-[Bb][Ff]04\\-[Aa]38[Dd][Aa]5[Ff]06[Ee]41\\}\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss][Dd][Ee][Ss][Kk][Tt][Oo][Pp]\\-[Rr][Uu][Nn][Tt][Ii][Mm][Ee]\\-.*/) OR ((process.executable:/.*\\\\[Vv][Cc]\\_[Rr][Ee][Dd][Ii][Ss][Tt]\\.[Xx]64\\.[Ee][Xx][Ee]/ AND winlog.event_data.Details:/.*\\}\\\\[Vv][Cc]\\_[Rr][Ee][Dd][Ii][Ss][Tt]\\.[Xx]64\\.[Ee][Xx][Ee]\\\"\\ \\/[Bb][Uu][Rr][Nn]\\.[Rr][Uu][Nn][Oo][Nn][Cc][Ee]/)) OR ((process.executable:(/[Cc]\\:\\\\[Pp][Rr][Oo][Gg][Rr][Aa][Mm][Dd][Aa][Tt][Aa]\\\\[Pp][Aa][Cc][Kk][Aa][Gg][Ee]\\ [Cc][Aa][Cc][Hh][Ee].*/ OR /[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Tt][Ee][Mm][Pp]\\\\.*/) AND process.executable:(/.*\\\\[Ww][Ii][Nn][Ss][Dd][Kk][Ss][Ee][Tt][Uu][Pp]\\.[Ee][Xx][Ee].*/ OR /.*\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss][Dd][Ee][Ss][Kk][Tt][Oo][Pp]\\-[Rr][Uu][Nn][Tt][Ii][Mm][Ee]\\-.*/ OR /.*\\\\[Aa][Ss][Pp][Nn][Ee][Tt][Cc][Oo][Rr][Ee][Ss][Hh][Aa][Rr][Ee][Dd][Ff][Rr][Aa][Mm][Ee][Ww][Oo][Rr][Kk][Bb][Uu][Nn][Dd][Ll][Ee]\\-.*/) AND winlog.event_data.Details:/.*\\ \\/[Bb][Uu][Rr][Nn]\\.[Rr][Uu][Nn][Oo][Nn][Cc][Ee]/)) OR ((process.executable:/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ii][Nn][Ss][Tt][Aa][Ll][Ll][Ee][Rr]\\\\[Mm][Ss][Ii].*/ AND winlog.event_data.TargetObject:/.*\\\\[Ee][Xx][Pp][Ll][Oo][Rr][Ee][Rr]\\\\[Bb][Rr][Oo][Ww][Ss][Ee][Rr]\\ [Hh][Ee][Ll][Pp][Ee][Rr]\\ [Oo][Bb][Jj][Ee][Cc][Tt][Ss].*/)) OR ((process.executable:/[Cc]\\:\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Ss][Yy][Ss][Tt][Ee][Mm]32\\\\[Mm][Ss][Ii][Ee][Xx][Ee][Cc]\\.[Ee][Xx][Ee]/ AND winlog.event_data.TargetObject:/.*\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Ww][Oo][Ww]6432[Nn][Oo][Dd][Ee]\\\\[Mm][Ii][Cc][Rr][Oo][Ss][Oo][Ff][Tt]\\\\[Ww][Ii][Nn][Dd][Oo][Ww][Ss]\\\\[Cc][Uu][Rr][Rr][Ee][Nn][Tt][Vv][Ee][Rr][Ss][Ii][Oo][Nn]\\\\[Rr][Uu][Nn]\\\\.*/)))))", "meta": {"from": "1m"}, "severity": "medium", "tags": ["T1547"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0003", "reference": "https://attack.mitre.org/tactics/TA0003", "name": "Persistence"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1547", "name": "Boot or Logon Autostart Execution", "reference": "https://attack.mitre.org/techniques/T1547"}]}], "version": 1, "references": ["https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md", "https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns", "https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d", "https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
