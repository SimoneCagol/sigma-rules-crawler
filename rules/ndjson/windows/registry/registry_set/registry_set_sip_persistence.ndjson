{"description": "Detects when an attacker register a new SIP provider for persistence and defense evasion", "enabled": false, "false_positives": ["Legitimate SIP being registered by the OS or different software."], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "5c6c9196-71aa-c187-f2e2-fcabff41100e", "language": "lucene", "max_signals": 100, "risk_score": 35, "name": "Persistence Via New SIP Provider", "query": "((winlog.event_data.EventType:\"SetValue\" AND winlog.event_data.TargetObject:(*\\\\SOFTWARE\\\\Microsoft\\\\Cryptography\\\\Providers\\\\* OR *\\\\SOFTWARE\\\\Microsoft\\\\Cryptography\\\\OID\\\\EncodingType* OR *\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Cryptography\\\\Providers\\\\* OR *\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Cryptography\\\\OID\\\\EncodingType*) AND winlog.event_data.TargetObject:(*\\\\Dll* OR *\\\\$DLL*)) AND (NOT ((winlog.event_data.Details:(\"WINTRUST.DLL\" OR \"mso.dll\")) OR (process.executable.text:\"C\\:\\\\Windows\\\\System32\\\\poqexec.exe\" AND winlog.event_data.TargetObject:*\\\\CryptSIPDll* AND winlog.event_data.Details:\"C\\:\\\\Windows\\\\System32\\\\PsfSip.dll\"))))", "meta": {"from": "1m"}, "severity": "medium", "tags": ["Defense Evasion", "T1553"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0005", "reference": "https://attack.mitre.org/tactics/TA0005", "name": "Defense Evasion"}, "framework": "MITRE ATT&CK\u00ae", "technique": [{"id": "T1553", "name": "Subvert Trust Controls", "reference": "https://attack.mitre.org/techniques/T1553"}]}], "version": 1, "references": ["https://persistence-info.github.io/Data/codesigning.html", "https://github.com/gtworek/PSBits/tree/master/SIP", "https://specterops.io/assets/resources/SpecterOps_Subverting_Trust_in_Windows.pdf"], "timestamp_override": "event.ingested", "author": ["Nasreddine Bencherchali"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md"}
