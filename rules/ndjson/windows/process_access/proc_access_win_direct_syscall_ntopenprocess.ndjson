{"description": "Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF.", "author": ["Christian Burkard", "Tim Shelton"], "enabled": false, "false_positives": ["Unknown"], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "00ad272d-c72e-1637-47b3-328ade39d648", "language": "lucene", "max_signals": 100, "risk_score": 65, "name": "Direct Syscall of NtOpenProcess", "query": "(winlog.event_data.CallTrace:UNKNOWN* AND (NOT (((winlog.event_data.TargetImage:\"C:\\Program Files\\Cylance\\Desktop\\CylanceUI.exe\" AND process.executable.text:\"C:\\Windows\\Explorer.EXE\")) OR ((winlog.event_data.TargetImage:\"C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\MicrosoftEdgeUpdate.exe\" AND process.executable.text:C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\Temp\\\\* AND process.executable.text:*\\\\MicrosoftEdgeUpdate.exe)) OR ((winlog.event_data.TargetImage:*vcredist_x64.exe AND process.executable.text:*vcredist_x64.exe)) OR ((winlog.event_data.TargetImage:\"C:\\Windows\\system32\\systeminfo.exe\" AND process.executable.text:*setup64.exe)) OR ((winlog.event_data.TargetImage:*AmazonSSMAgentSetup.exe AND process.executable.text:*AmazonSSMAgentSetup.exe)) OR ((winlog.event_data.TargetImage:*C\\:\\\\Program\\ Files\\\\Mozilla\\ Firefox\\\\firefox.exe AND process.executable.text:*C\\:\\\\Program\\ Files\\\\Mozilla\\ Firefox\\\\firefox.exe)) OR ((winlog.event_data.TargetImage:*\\\\AppData\\\\Local\\\\Programs\\\\Microsoft\\ VS\\ Code\\\\Code.exe AND process.executable.text:*\\\\AppData\\\\Local\\\\Programs\\\\Microsoft\\ VS\\ Code\\\\Code.exe)) OR ((winlog.event_data.TargetImage:*C\\:\\\\Program\\ Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe AND process.executable.text:*C\\:\\\\Program\\ Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe)) OR ((winlog.event_data.TargetImage:*C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Google\\\\Update\\\\GoogleUpdate.exe AND process.executable.text:*C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Google\\\\Update\\\\GoogleUpdate.exe)) OR ((winlog.event_data.TargetImage:*\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe AND process.executable.text:*\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe)) OR ((winlog.event_data.TargetImage:\"C:\\Windows\\System32\\backgroundTaskHost.exe\" AND process.executable.text:\"C:\\Windows\\System32\\backgroundTaskHost.exe\")) OR ((winlog.event_data.TargetImage:\"C:\\Program Files (x86)\\CCleaner Browser\\Application\\CCleanerBrowser.exe\" AND process.executable.text:\"C:\\Program Files (x86)\\CCleaner Browser\\Application\\CCleanerBrowser.exe\")) OR ((winlog.event_data.TargetImage:C\\:\\\\Users\\\\* AND winlog.event_data.TargetImage:*\\\\AppData\\\\Local\\\\Discord\\\\* AND winlog.event_data.TargetImage:*\\\\Discord.exe)) OR ((winlog.event_data.TargetImage:\"C:\\WINDOWS\\system32\\AUDIODG.EXE\")) OR ((Provider_Name:\"Microsoft-Windows-Kernel-Audit-API-Calls\")) OR ((winlog.event_data.TargetImage:*\\\\Evernote\\\\Evernote.exe)))))", "meta": {"from": "1m"}, "severity": "high", "tags": ["T1106"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0002", "reference": "https://attack.mitre.org/tactics/TA0002", "name": "Execution"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1106", "name": "Native API", "reference": "https://attack.mitre.org/techniques/T1106"}]}], "version": 1, "references": ["https://medium.com/falconforce/falconfriday-direct-system-calls-and-cobalt-strike-bofs-0xff14-741fa8e1bdd6"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
