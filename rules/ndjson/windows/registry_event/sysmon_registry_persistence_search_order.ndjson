{"description":"Detects potential COM object hijacking leveraging the COM Search Order Author: Maxime Thiebaut (@0xThiebaut), oscd.community, Cédric Hien. License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md","enabled":false,"false_positives":["Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level"],"filters":[],"from":"now-360s","immutable":false,"index":["winlogbeat-*"],"interval":"5m","rule_id":"a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12","language":"lucene","output_index":".siem-signals-default","max_signals":100,"risk_score":35,"name":"Windows Registry Persistence COM Search Order Hijacking","query":"((winlog.event_data.EventType:\"SetValue\" AND winlog.event_data.TargetObject:(HKCR\\\\CLSID\\\\* OR HKCU\\\\Software\\\\Classes\\\\CLSID\\\\*) AND winlog.event_data.TargetObject:*\\\\InprocServer32\\\\\\(Default\\)) AND (NOT ((winlog.event_data.Details:(*%%systemroot%%\\\\system32\\\\* OR *%%systemroot%%\\\\SysWow64\\\\*)) OR (winlog.event_data.Details:(*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\* OR *\\\\FileCoAuthLib64.dll* OR *\\\\FileSyncShell64.dll* OR *\\\\FileSyncApi64.dll*)) OR (winlog.event_data.Details:*\\\\AppData\\\\Local\\\\Microsoft\\\\TeamsMeetingAddin\\\\* AND winlog.event_data.Details:*\\\\Microsoft.Teams.AddinLoader.dll*) OR (winlog.event_data.Details:*\\\\AppData\\\\Roaming\\\\Dropbox\\\\* AND winlog.event_data.Details:*\\\\DropboxExt64.*.dll*) OR (winlog.event_data.Details:*TmopIEPlg.dll) OR (process.executable:(\"C\\:\\\\WINDOWS\\\\system32\\\\wuauclt.exe\" OR \"C\\:\\\\WINDOWS\\\\system32\\\\svchost.exe\")) OR (process.executable:*C\\:\\\\ProgramData\\\\Microsoft\\\\Windows\\ Defender\\\\Platform\\\\* AND process.executable:*\\\\MsMpEng.exe*) OR (winlog.event_data.Details:*\\\\FileRepository\\\\nvmdi.inf*) OR (process.executable:*\\\\MicrosoftEdgeUpdateComRegisterShell64.exe) OR (process.executable:\"C\\:\\\\WINDOWS\\\\SYSTEM32\\\\dxdiag.exe\") OR (winlog.event_data.Details:(\"C\\:\\\\Windows\\\\pyshellext.amd64.dll\" OR \"C\\:\\\\Windows\\\\pyshellext.dll\")) OR (winlog.event_data.Details:(\"C\\:\\\\Windows\\\\system32\\\\dnssdX.dll\" OR \"C\\:\\\\Windows\\\\SysWOW64\\\\dnssdX.dll\")) OR (winlog.event_data.Details:(C\\:\\\\Program\\ Files\\\\* OR C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\*)) OR (winlog.event_data.Details:*C\\:\\\\WINDOWS\\\\system32\\\\GamingServicesProxy.dll*))))","meta":{"from":"1m"},"severity":"medium","tags":["T1546"],"to":"now","type":"query","threat":[{"tactic":{"id":"TA0003","reference":"https://attack.mitre.org/tactics/TA0003","name":"Persistence"},"framework":"MITRE ATT&CK®","technique":[{"id":"T1546","name":"Event Triggered Execution","reference":"https://attack.mitre.org/techniques/T1546"}]}],"version":1,"references":["https://tdm.socprime.com/tdm/info/0"]}
