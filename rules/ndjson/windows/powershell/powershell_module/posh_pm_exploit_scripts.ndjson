{"description": "Detects the execution of known offensive powershell scripts used for exploitation or reconnaissance", "author": ["frack113", "Nasreddine Bencherchali"], "enabled": false, "false_positives": ["Unknown"], "filters": [], "from": "now-360s", "immutable": false, "index": ["winlogbeat-*"], "interval": "5m", "rule_id": "41025fd7-0466-4650-a813-574aaacbe7f4", "language": "lucene", "max_signals": 100, "risk_score": 65, "name": "Malicious PowerShell Scripts - PoshModule", "query": "((ContextInfo:(*Add\\-ConstrainedDelegationBackdoor.ps1* OR *Add\\-Exfiltration.ps1* OR *Add\\-Persistence.ps1* OR *Add\\-RegBackdoor.ps1* OR *Add\\-RemoteRegBackdoor.ps1* OR *Add\\-ScrnSaveBackdoor.ps1* OR *Check\\-VM.ps1* OR *ConvertTo\\-ROT13.ps1* OR *Copy\\-VSS.ps1* OR *Create\\-MultipleSessions.ps1* OR *DNS_TXT_Pwnage.ps1* OR *Do\\-Exfiltration.ps1* OR *DomainPasswordSpray.ps1* OR *Download_Execute.ps1* OR *Download\\-Execute\\-PS.ps1* OR *Enabled\\-DuplicateToken.ps1* OR *Enable\\-DuplicateToken.ps1* OR *Execute\\-Command\\-MSSQL.ps1* OR *Execute\\-DNSTXT\\-Code.ps1* OR *Execute\\-OnTime.ps1* OR *ExetoText.ps1* OR *Exploit\\-Jboss.ps1* OR *Find\\-AVSignature.ps1* OR *Find\\-Fruit.ps1* OR *Find\\-GPOLocation.ps1* OR *Find\\-TrustedDocuments.ps1* OR *FireBuster.ps1* OR *FireListener.ps1* OR *Get\\-ApplicationHost.ps1* OR *Get\\-ChromeDump.ps1* OR *Get\\-ClipboardContents.ps1* OR *Get\\-ComputerDetail.ps1* OR *Get\\-FoxDump.ps1* OR *Get\\-GPPAutologon.ps1* OR *Get\\-GPPPassword.ps1* OR *Get\\-IndexedItem.ps1* OR *Get\\-Keystrokes.ps1* OR *Get\\-LSASecret.ps1* OR *Get\\-MicrophoneAudio.ps1* OR *Get\\-PassHashes.ps1* OR *Get\\-PassHints.ps1* OR *Get\\-RegAlwaysInstallElevated.ps1* OR *Get\\-RegAutoLogon.ps1* OR *Get\\-RickAstley.ps1* OR *Get\\-Screenshot.ps1* OR *Get\\-SecurityPackages.ps1* OR *Get\\-ServiceFilePermission.ps1* OR *Get\\-ServicePermission.ps1* OR *Get\\-ServiceUnquoted.ps1* OR *Get\\-SiteListPassword.ps1* OR *Get\\-System.ps1* OR *Get\\-TimedScreenshot.ps1* OR *Get\\-UnattendedInstallFile.ps1* OR *Get\\-Unconstrained.ps1* OR *Get\\-USBKeystrokes.ps1* OR *Get\\-VaultCredential.ps1* OR *Get\\-VulnAutoRun.ps1* OR *Get\\-VulnSchTask.ps1* OR *Get\\-WebConfig.ps1* OR *Get\\-WebCredentials.ps1* OR *Get\\-WLAN\\-Keys.ps1* OR *Gupt\\-Backdoor.ps1* OR *HTTP\\-Backdoor.ps1* OR *HTTP\\-Login.ps1* OR *Install\\-ServiceBinary.ps1* OR *Install\\-SSP.ps1* OR *Invoke\\-ACLScanner.ps1* OR *Invoke\\-ADSBackdoor.ps1* OR *Invoke\\-AmsiBypass.ps1* OR *Invoke\\-ARPScan.ps1* OR *Invoke\\-BackdoorLNK.ps1* OR *Invoke\\-BadPotato.ps1* OR *Invoke\\-BetterSafetyKatz.ps1* OR *Invoke\\-BruteForce.ps1* OR *Invoke\\-BypassUAC.ps1* OR *Invoke\\-Carbuncle.ps1* OR *Invoke\\-Certify.ps1* OR *Invoke\\-ConPtyShell.ps1* OR *Invoke\\-CredentialInjection.ps1* OR *Invoke\\-CredentialsPhish.ps1* OR *Invoke\\-DAFT.ps1* OR *Invoke\\-DCSync.ps1* OR *Invoke\\-Decode.ps1* OR *Invoke\\-DinvokeKatz.ps1* OR *Invoke\\-DllInjection.ps1* OR *Invoke\\-DowngradeAccount.ps1* OR *Invoke\\-EgressCheck.ps1* OR *Invoke\\-Encode.ps1* OR *Invoke\\-EventViewer.ps1* OR *Invoke\\-Eyewitness.ps1* OR *Invoke\\-FakeLogonScreen.ps1* OR *Invoke\\-Farmer.ps1* OR *Invoke\\-Get\\-RBCD\\-Threaded.ps1* OR *Invoke\\-Gopher.ps1* OR *Invoke\\-Grouper2.ps1* OR *Invoke\\-Grouper3.ps1* OR *Invoke\\-HandleKatz.ps1* OR *Invoke\\-Interceptor.ps1* OR *Invoke\\-Internalmonologue.ps1* OR *Invoke\\-Inveigh.ps1* OR *Invoke\\-InveighRelay.ps1* OR *Invoke\\-JSRatRegsvr.ps1* OR *Invoke\\-JSRatRundll.ps1* OR *Invoke\\-KrbRelay.ps1* OR *Invoke\\-KrbRelayUp.ps1* OR *Invoke\\-LdapSignCheck.ps1* OR *Invoke\\-Lockless.ps1* OR *Invoke\\-MalSCCM.ps1* OR *Invoke\\-Mimikatz.ps1* OR *Invoke\\-MimikatzWDigestDowngrade.ps1* OR *Invoke\\-Mimikittenz.ps1* OR *Invoke\\-MITM6.ps1* OR *Invoke\\-NanoDump.ps1* OR *Invoke\\-NetRipper.ps1* OR *Invoke\\-NetworkRelay.ps1* OR *Invoke\\-NinjaCopy.ps1* OR *Invoke\\-OxidResolver.ps1* OR *Invoke\\-P0wnedshell.ps1* OR *Invoke\\-P0wnedshellx86.ps1* OR *Invoke\\-Paranoia.ps1* OR *Invoke\\-PortScan.ps1* OR *Invoke\\-PoshRatHttp.ps1* OR *Invoke\\-PoshRatHttps.ps1* OR *Invoke\\-PostExfil.ps1* OR *Invoke\\-PowerDump.ps1* OR *Invoke\\-PowerShellIcmp.ps1* OR *Invoke\\-PowerShellTCP.ps1* OR *Invoke\\-PowerShellTcpOneLine.ps1* OR *Invoke\\-PowerShellTcpOneLineBind.ps1* OR *Invoke\\-PowerShellUdp.ps1* OR *Invoke\\-PowerShellUdpOneLine.ps1* OR *Invoke\\-PowerShellWMI.ps1* OR *Invoke\\-PowerThIEf.ps1* OR *Invoke\\-PPLDump.ps1* OR *Invoke\\-Prasadhak.ps1* OR *Invoke\\-PsExec.ps1* OR *Invoke\\-PsGcat.ps1* OR *Invoke\\-PsGcatAgent.ps1* OR *Invoke\\-PSInject.ps1* OR *Invoke\\-PsUaCme.ps1* OR *Invoke\\-ReflectivePEInjection.ps1* OR *Invoke\\-ReverseDNSLookup.ps1* OR *Invoke\\-Rubeus.ps1* OR *Invoke\\-RunAs.ps1* OR *Invoke\\-SafetyKatz.ps1* OR *Invoke\\-SauronEye.ps1* OR *Invoke\\-SCShell.ps1* OR *Invoke\\-Seatbelt.ps1* OR *Invoke\\-ServiceAbuse.ps1* OR *Invoke\\-SessionGopher.ps1* OR *Invoke\\-ShellCode.ps1* OR *Invoke\\-SMBScanner.ps1* OR *Invoke\\-Snaffler.ps1* OR *Invoke\\-Spoolsample.ps1* OR *Invoke\\-SSHCommand.ps1* OR *Invoke\\-SSIDExfil.ps1* OR *Invoke\\-StandIn.ps1* OR *Invoke\\-StickyNotesExtract.ps1* OR *Invoke\\-Tater.ps1* OR *Invoke\\-Thunderfox.ps1* OR *Invoke\\-ThunderStruck.ps1* OR *Invoke\\-TokenManipulation.ps1* OR *Invoke\\-Tokenvator.ps1* OR *Invoke\\-TotalExec.ps1* OR *Invoke\\-UrbanBishop.ps1* OR *Invoke\\-UserHunter.ps1* OR *Invoke\\-VoiceTroll.ps1* OR *Invoke\\-Whisker.ps1* OR *Invoke\\-WinEnum.ps1* OR *Invoke\\-winPEAS.ps1* OR *Invoke\\-WireTap.ps1* OR *Invoke\\-WmiCommand.ps1* OR *Invoke\\-WScriptBypassUAC.ps1* OR *Invoke\\-Zerologon.ps1* OR *Keylogger.ps1* OR *MailRaider.ps1* OR *New\\-HoneyHash.ps1* OR *OfficeMemScraper.ps1* OR *Offline_Winpwn.ps1* OR *Out\\-CHM.ps1* OR *Out\\-DnsTxt.ps1* OR *Out\\-Excel.ps1* OR *Out\\-HTA.ps1* OR *Out\\-Java.ps1* OR *Out\\-JS.ps1* OR *Out\\-Minidump.ps1* OR *Out\\-RundllCommand.ps1* OR *Out\\-SCF.ps1* OR *Out\\-SCT.ps1* OR *Out\\-Shortcut.ps1* OR *Out\\-WebQuery.ps1* OR *Out\\-Word.ps1* OR *Parse_Keys.ps1* OR *Port\\-Scan.ps1* OR *PowerBreach.ps1* OR *powercat.ps1* OR *PowerRunAsSystem.psm1* OR *PowerSharpPack.ps1* OR *PowerUp.ps1* OR *PowerUpSQL.ps1* OR *PowerView.ps1* OR *PSAsyncShell.ps1* OR *RemoteHashRetrieval.ps1* OR *Remove\\-Persistence.ps1* OR *Remove\\-PoshRat.ps1* OR *Remove\\-Update.ps1* OR *Run\\-EXEonRemote.ps1* OR *Set\\-DCShadowPermissions.ps1* OR *Set\\-MacAttribute.ps1* OR *Set\\-RemotePSRemoting.ps1* OR *Set\\-RemoteWMI.ps1* OR *Set\\-Wallpaper.ps1* OR *Show\\-TargetScreen.ps1* OR *Speak.ps1* OR *Start\\-CaptureServer.ps1* OR *Start\\-WebcamRecorder.ps1* OR *StringToBase64.ps1* OR *TexttoExe.ps1* OR *VolumeShadowCopyTools.ps1* OR *WinPwn.ps1* OR *WSUSpendu.ps1*)) OR ((ContextInfo:*Invoke\\-Sharp* AND ContextInfo:*.ps1*)))", "meta": {"from": "1m"}, "severity": "high", "tags": ["T1059"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0002", "reference": "https://attack.mitre.org/tactics/TA0002", "name": "Execution"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1059", "name": "Command and Scripting Interpreter", "reference": "https://attack.mitre.org/techniques/T1059"}]}], "version": 1, "references": ["https://github.com/PowerShellMafia/PowerSploit", "https://github.com/NetSPI/PowerUpSQL", "https://github.com/CsEnox/EventViewer-UACBypass", "https://github.com/AlsidOfficial/WSUSpendu/", "https://github.com/nettitude/Invoke-PowerThIEf", "https://github.com/S3cur3Th1sSh1t/WinPwn", "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries", "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1", "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1", "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1", "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1", "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/", "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/", "https://github.com/HarmJ0y/DAMP", "https://github.com/samratashok/nishang", "https://github.com/DarkCoderSc/PowerRunAsSystem/", "https://github.com/besimorhino/powercat"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
