{"description": "Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 in different header fields found in web server logs (Log4Shell)", "author": ["Florian Roth"], "enabled": false, "false_positives": ["Vulnerability scanning"], "filters": [], "from": "now-360s", "immutable": false, "index": ["filebeat-*"], "interval": "5m", "rule_id": "7e7f80ed-10d9-3a1e-5b2e-ab66865ccdf6", "language": "lucene", "max_signals": 100, "risk_score": 65, "name": "Log4j RCE CVE-2021-44228 in Fields", "query": "((cs-user-agent:(*$\\{jndi\\:ldap\\:\\/* OR *$\\{jndi\\:rmi\\:\\/* OR *$\\{jndi\\:ldaps\\:\\/* OR *$\\{jndi\\:dns\\:\\/* OR *\\/$%7bjndi\\:* OR *%24%7bjndi\\:* OR *$%7Bjndi\\:* OR *%2524%257Bjndi* OR *%2F%252524%25257Bjndi%3A* OR *$\\{jndi\\:$\\{lower\\:* OR *$\\{\\:\\:\\-j\\}$\\{* OR *$\\{jndi\\:nis* OR *$\\{jndi\\:nds* OR *$\\{jndi\\:corba* OR *$\\{jndi\\:iiop* OR *Reference\\ Class\\ Name\\:\\ foo* OR *$\\{$\\{env\\:BARFOO\\:\\-j\\}* OR *$\\{\\:\\:\\-l\\}$\\{\\:\\:\\-d\\}$\\{\\:\\:\\-a\\}$\\{\\:\\:\\-p\\}* OR *$\\{base64\\:JHtqbmRp* OR *$\\{$\\{env\\:ENV_NAME\\:\\-j\\}ndi$\\{env\\:ENV_NAME\\:\\-\\:\\}$* OR *$\\{$\\{lower\\:j\\}ndi\\:* OR *$\\{$\\{upper\\:j\\}ndi\\:* OR *$\\{$\\{\\:\\:\\-j\\}$\\{\\:\\:\\-n\\}$\\{\\:\\:\\-d\\}$\\{\\:\\:\\-i\\}\\:*)) OR (cs-uri-query:(*$\\{jndi\\:ldap\\:\\/* OR *$\\{jndi\\:rmi\\:\\/* OR *$\\{jndi\\:ldaps\\:\\/* OR *$\\{jndi\\:dns\\:\\/* OR *\\/$%7bjndi\\:* OR *%24%7bjndi\\:* OR *$%7Bjndi\\:* OR *%2524%257Bjndi* OR *%2F%252524%25257Bjndi%3A* OR *$\\{jndi\\:$\\{lower\\:* OR *$\\{\\:\\:\\-j\\}$\\{* OR *$\\{jndi\\:nis* OR *$\\{jndi\\:nds* OR *$\\{jndi\\:corba* OR *$\\{jndi\\:iiop* OR *Reference\\ Class\\ Name\\:\\ foo* OR *$\\{$\\{env\\:BARFOO\\:\\-j\\}* OR *$\\{\\:\\:\\-l\\}$\\{\\:\\:\\-d\\}$\\{\\:\\:\\-a\\}$\\{\\:\\:\\-p\\}* OR *$\\{base64\\:JHtqbmRp* OR *$\\{$\\{env\\:ENV_NAME\\:\\-j\\}ndi$\\{env\\:ENV_NAME\\:\\-\\:\\}$* OR *$\\{$\\{lower\\:j\\}ndi\\:* OR *$\\{$\\{upper\\:j\\}ndi\\:* OR *$\\{$\\{\\:\\:\\-j\\}$\\{\\:\\:\\-n\\}$\\{\\:\\:\\-d\\}$\\{\\:\\:\\-i\\}\\:*)) OR (cs-referer:(*$\\{jndi\\:ldap\\:\\/* OR *$\\{jndi\\:rmi\\:\\/* OR *$\\{jndi\\:ldaps\\:\\/* OR *$\\{jndi\\:dns\\:\\/* OR *\\/$%7bjndi\\:* OR *%24%7bjndi\\:* OR *$%7Bjndi\\:* OR *%2524%257Bjndi* OR *%2F%252524%25257Bjndi%3A* OR *$\\{jndi\\:$\\{lower\\:* OR *$\\{\\:\\:\\-j\\}$\\{* OR *$\\{jndi\\:nis* OR *$\\{jndi\\:nds* OR *$\\{jndi\\:corba* OR *$\\{jndi\\:iiop* OR *Reference\\ Class\\ Name\\:\\ foo* OR *$\\{$\\{env\\:BARFOO\\:\\-j\\}* OR *$\\{\\:\\:\\-l\\}$\\{\\:\\:\\-d\\}$\\{\\:\\:\\-a\\}$\\{\\:\\:\\-p\\}* OR *$\\{base64\\:JHtqbmRp* OR *$\\{$\\{env\\:ENV_NAME\\:\\-j\\}ndi$\\{env\\:ENV_NAME\\:\\-\\:\\}$* OR *$\\{$\\{lower\\:j\\}ndi\\:* OR *$\\{$\\{upper\\:j\\}ndi\\:* OR *$\\{$\\{\\:\\:\\-j\\}$\\{\\:\\:\\-n\\}$\\{\\:\\:\\-d\\}$\\{\\:\\:\\-i\\}\\:*)))", "meta": {"from": "1m"}, "severity": "high", "tags": ["Initial Access", "T1190"], "to": "now", "type": "query", "threat": [{"tactic": {"id": "TA0001", "reference": "https://attack.mitre.org/tactics/TA0001", "name": "Initial Access"}, "framework": "MITRE ATT&CK", "technique": [{"id": "T1190", "name": "Exploit Public-Facing Application", "reference": "https://attack.mitre.org/techniques/T1190"}]}], "version": 1, "references": ["https://www.lunasec.io/docs/blog/log4j-zero-day/", "https://news.ycombinator.com/item?id=29504755", "https://github.com/tangxiaofeng7/apache-log4j-poc", "https://gist.github.com/Neo23x0/e4c8b03ff8cdf1fa63b7d15db6e3860b", "https://github.com/YfryTchsGD/Log4jAttackSurface", "https://twitter.com/shutingrz/status/1469255861394866177?s=21"], "license": "https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md", "timestamp_override": "event.ingested"}
